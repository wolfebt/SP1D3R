<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SP1D3R</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.53.0/min/vs/loader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsdiff/5.1.0/diff.min.js"></script>
    <script src="https://unpkg.com/@isomorphic-git/lightning-fs"></script>
    <script src="https://unpkg.com/isomorphic-git"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;600&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-900 text-gray-300">

    <input type="file" id="file-input" webkitdirectory directory multiple class="hidden">

    <!-- Modals -->
    <div id="refactor-review-modal" class="fixed inset-0 bg-black bg-opacity-75 z-[80] hidden items-center justify-center p-4">
        <div class="modal-content p-0 rounded-lg w-full max-w-6xl max-h-[90vh] flex flex-col">
            <div class="p-4 border-b border-gray-700 flex justify-between items-center flex-shrink-0">
                <h3 class="text-xl font-bold text-white">Review Proposed Refactoring</h3>
                <button id="close-refactor-modal-btn" class="text-gray-400 hover:text-white text-3xl font-bold">&times;</button>
            </div>
            <div class="flex-grow flex overflow-hidden">
                <div id="refactor-file-list" class="w-1/4 bg-gray-900 overflow-y-auto border-r border-gray-700 p-2">
                    <!-- File list will be populated here -->
                </div>
                <div class="w-3/4 flex flex-col">
                    <div id="refactor-diff-view" class="flex-grow overflow-y-auto p-4 font-mono text-sm">
                        <p class="text-gray-500">Select a file to see the changes.</p>
                    </div>
                </div>
            </div>
            <div class="p-4 border-t border-gray-700 flex justify-end items-center space-x-4 flex-shrink-0">
                <span id="refactor-summary" class="text-sm text-gray-400"></span>
                <button id="cancel-refactor-btn" class="navigator-btn px-4 py-2 rounded-md">Cancel</button>
                <button id="approve-refactor-btn" class="submit-btn px-4 py-2 rounded-md">Approve Changes</button>
            </div>
        </div>
    </div>

    <div id="file-tree-modal" class="fixed inset-0 bg-black bg-opacity-75 z-50 hidden items-center justify-center p-4">
        <div class="bg-gray-800 rounded-lg shadow-xl w-full max-w-lg max-h-[80vh] flex flex-col border border-gray-700">
            <div class="p-4 border-b border-gray-700 flex justify-between items-center flex-shrink-0">
                <h3 id="file-tree-title" class="text-xl font-bold text-white">Project Files</h3>
                <div class="flex items-center space-x-2">
                    <button id="new-file-btn" title="New File" class="action-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="12" y1="18" x2="12" y2="12"></line><line x1="9" y1="15" x2="15" y2="15"></line></svg>
                    </button>
                    <button id="new-folder-btn" title="New Folder" class="action-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path><line x1="12" y1="11" x2="12" y2="17"></line><line x1="9" y1="14" x2="15" y2="14"></line></svg>
                    </button>
                    <button id="close-modal-btn" class="text-gray-400 hover:text-white text-2xl font-bold">&times;</button>
                </div>
            </div>
            <div id="file-tree-container" class="p-4 overflow-y-auto font-mono text-sm"></div>
        </div>
    </div>

    <div id="console-modal" class="fixed inset-0 bg-black bg-opacity-75 z-50 hidden items-center justify-center p-4">
        <div class="bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl h-3/4 flex flex-col border border-gray-700">
            <div class="p-4 border-b border-gray-700 flex justify-between items-center flex-shrink-0">
                <h3 class="text-xl font-bold text-white">Emulator Console</h3>
                <div class="flex items-center space-x-4">
                     <button id="clear-console-btn" title="Clear Console" class="text-gray-400 hover:text-white text-xs uppercase font-semibold">Clear</button>
                    <button id="close-console-modal-btn" class="text-gray-400 hover:text-white text-3xl font-bold">&times;</button>
                </div>
            </div>
            <div id="console-output" class="p-4 overflow-y-auto font-mono text-sm flex-grow space-y-2">
                 <div class="text-gray-500">Initializing emulator...</div>
            </div>
        </div>
    </div>
    
    <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-75 z-[60] hidden items-center justify-center p-4">
        <div class="modal-content p-8 rounded-lg w-full max-w-md">
            <h2 class="text-xl font-bold mb-4">Settings</h2>
            <label for="api-key-input" class="block mb-2 text-sm font-medium text-gray-400">Gemini API Key</label>
            <input type="password" id="api-key-input" class="prompt-input w-full p-2 rounded-md mb-2">
            <label for="github-pat-input" class="block mb-2 text-sm font-medium text-gray-400">GitHub Personal Access Token</label>
            <input type="password" id="github-pat-input" class="prompt-input w-full p-2 rounded-md mb-4">
            <div class="flex justify-end gap-4">
                <button id="cancel-settings-btn" class="navigator-btn px-4 py-2 rounded-md">Cancel</button>
                <button id="save-settings-btn" class="submit-btn px-4 py-2 rounded-md">Save</button>
            </div>
        </div>
    </div>
    <div id="analysis-modal" class="fixed inset-0 bg-black bg-opacity-75 z-[70] hidden items-center justify-center p-4">
        <div class="modal-content p-6 rounded-lg w-full max-w-4xl max-h-[90vh] flex flex-col">
            <div id="analysis-modal-content" class="prose flex-grow overflow-y-auto pr-4"></div>
            <div class="flex justify-end mt-4 pt-4 border-t border-gray-700">
                <button id="close-analysis-modal-btn" class="submit-btn px-4 py-2 rounded-md">Close</button>
            </div>
        </div>
    </div>
    <div id="audit-modal" class="fixed inset-0 bg-black bg-opacity-75 z-[60] hidden items-center justify-center p-4">
        <div class="modal-content p-6 rounded-lg w-full max-w-md flex flex-col">
             <div class="flex justify-between items-center mb-4">
                 <h3 class="text-xl font-bold text-white">Project & File Audit</h3>
                 <button id="close-audit-modal-btn" class="text-gray-400 hover:text-white text-3xl font-bold">&times;</button>
             </div>
             <div class="space-y-4">
                 <p class="text-sm text-gray-400">Run a quick analysis on the selected file or a custom analysis on the entire project.</p>
                 <div id="quick-audit-buttons" class="grid grid-cols-2 gap-2">
                     <button class="navigator-btn p-2 rounded-md text-sm" data-analysis="readability" disabled>Readability</button>
                     <button class="navigator-btn p-2 rounded-md text-sm" data-analysis="performance" disabled>Performance</button>
                     <button class="navigator-btn p-2 rounded-md text-sm" data-analysis="security" disabled>Security</button>
                     <button class="navigator-btn p-2 rounded-md text-sm" data-analysis="refactor" disabled>Suggest Refactor</button>
                 </div>
                 <textarea id="analysis-prompt-input" class="audit-input w-full p-2 text-sm rounded-lg" placeholder="Ask for a specific project or file analysis..." rows="3"></textarea>
                 <button id="run-audit-btn" class="submit-btn font-semibold px-4 py-2 rounded-lg w-full text-sm" disabled>Run Custom Audit</button>
             </div>
        </div>
    </div>

    <!-- Main Application Wrapper -->
    <div class="flex flex-col h-screen">
        <!-- Header -->
        <header class="bg-gray-800 border-b border-gray-700 p-4 flex items-center justify-between z-10">
            <div class="flex items-center space-x-6">
                <div class="flex items-center space-x-3">
                    <svg class="w-8 h-8 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                    <h1 class="text-2xl font-bold text-gray-200">SP1D3R</h1>
                    <button id="settings-btn" class="settings-btn p-2 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg></button>
                </div>
                <div class="flex items-center border-l border-gray-700 pl-6 space-x-2">
                    <button id="emulator-tab-btn" class="tab-btn active">Web Emulator</button>
                    <button id="coder-tab-btn" class="tab-btn">Pair Coder</button>
                    <button id="source-control-tab-btn" class="tab-btn">Source Control</button>
                </div>
            </div>
            <div id="emulator-controls" class="flex items-center space-x-4">
                <label for="file-input" id="select-project-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg cursor-pointer transition-all duration-300 inline-flex items-center shadow-sm">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg>
                    Select Project
                </label>
                <button id="view-files-btn" class="hidden bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg>View Files</button>
                <button id="download-zip-btn" class="hidden bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>Download Project</button>
                <button id="reset-btn" class="hidden bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>New Project</button>
                <div class="border-l h-8 border-gray-600"></div>
                <button id="view-console-btn" title="View Console" class="bg-gray-700 hover:bg-gray-600 text-white p-2 rounded-lg ml-2"><svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4C2.9 4 2 4.9 2 6V18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6C22 4.9 21.1 4 20 4ZM8 17H6V15H8V17ZM12 11H6V9H12V11Z"/></svg></button>
            </div>
            <div id="coder-controls" class="hidden items-center space-x-4">
                 
            </div>
        </header>

        <!-- Main Content Area -->
        <div id="main-content" class="flex-grow overflow-hidden">
            <!-- Web Emulator View -->
            <main id="emulator-view" class="flex-grow flex flex-col overflow-hidden h-full">
                <div id="render-panel" class="w-full flex-grow flex flex-col bg-gray-900 overflow-auto">
                    <div id="instructions" class="flex flex-col items-center p-8 text-center">
                        <h2 class="text-3xl font-bold mb-4 text-gray-100">Web Application Emulator</h2>
                        <p class="text-gray-400 max-w-xl mb-8">Preview your multi-file React or Static HTML projects by selecting a project folder.</p>
                    </div>
                    <div id="loading-state" class="hidden flex-col items-center justify-center h-full">
                        <div class="spinner"></div>
                        <p class="mt-4 text-gray-500">Processing your application...</p>
                    </div>
                    <div id="app-root" class="flex-grow w-full h-full" style="display: none;"></div>
                    <iframe id="static-site-frame" style="display: none;"></iframe>
                </div>
            </main>

            <!-- Pair Coder View -->
             <main id="coder-view" class="hidden h-full flex overflow-hidden">
                <!-- Left Sidebar -->
                <div id="coder-sidebar" class="bg-gray-800 p-4 flex flex-col overflow-hidden" style="width: 25%;">
                    <div id="code-generation-container" class="flex flex-col h-1/2 min-h-[250px] mb-4">
                        <div class="flex justify-between items-center mb-2">
                             <label class="text-lg font-semibold text-gray-300">AI Chat</label>
                             <p id="status-message" class="text-sm text-gray-500 h-5"></p>
                        </div>
                        <div id="chat-history" class="flex-grow p-4 space-y-4 overflow-y-auto bg-gray-900 rounded-t-lg flex flex-col">
                            <div class="chat-message ai p-3 rounded-lg max-w-xl text-sm">
                                <p>Hello! I'm your AI pair programmer. Load a project, select a file, and tell me what you'd like to do. You can also ask me any programming question.</p>
                            </div>
                        </div>
                        <form id="chat-form" class="flex flex-col">
                            <textarea id="chat-input" class="w-full p-2 text-sm rounded-md resize-none" placeholder="Ask a question or request a code change..." rows="3"></textarea>
                            <div class="flex justify-end mt-2">
                                <button id="send-chat-btn" type="submit" class="submit-btn font-semibold px-4 py-2 rounded-lg flex items-center text-sm">
                                    Send
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                                </button>
                            </div>
                        </form>
                    </div>

                    <div class="flex flex-col flex-grow overflow-hidden">
                        <div class="flex justify-between items-center mb-2">
                             <h3 class="text-lg font-semibold text-gray-300">Functions</h3>
                             <button id="open-audit-modal-btn" class="navigator-btn px-3 py-1 rounded-md text-sm" disabled>Audit</button>
                        </div>
                        <div id="function-list" class="flex-grow overflow-y-auto border-t border-gray-700 py-2">
                            <p class="text-xs text-gray-500">Select a file to see its functions.</p>
                        </div>
                    </div>
                </div>

                <!-- Resizer Handle -->
                <div id="resizer" class="resizable-handle"></div>
                
                <!-- Right Main Panel -->
                <div id="main-coder-panel" class="flex-grow p-4 flex flex-col overflow-hidden" style="width: 75%;">
                    <div class="flex justify-between items-center mb-2">
                        <div>
                            <label for="code-editor" class="text-lg font-semibold text-gray-300">Main Canvas</label>
                            <p id="current-file-display" class="text-xs text-gray-500 code-font">No file selected.</p>
                        </div>
                        <div class="flex items-center gap-2 flex-wrap">
                            <label for="live-refresh-toggle" class="flex items-center text-sm cursor-pointer pr-2" title="Automatically refresh the emulator on code change">
                                <input type="checkbox" id="live-refresh-toggle" class="form-checkbox h-4 w-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500" checked>
                                <span class="ml-2 text-gray-300">Live Refresh</span>
                            </label>
                            <div class="border-l h-5 border-gray-600"></div>
                            <button id="generate-tests-btn" class="navigator-btn px-3 py-1 rounded-md text-sm" disabled>Generate Tests</button>
                            <button id="copy-code-btn" class="navigator-btn px-3 py-1 rounded-md text-sm">Copy</button>
                            <button id="select-file-btn" class="navigator-btn px-3 py-1 rounded-md text-sm" disabled>Select File</button>
                            <button id="save-file-btn" class="navigator-btn px-3 py-1 rounded-md text-sm" disabled>Save & Refresh</button>
                            <button id="undo-btn" class="navigator-btn px-3 py-1 rounded-md text-sm" disabled>Undo</button>
                            <button id="redo-btn" class="navigator-btn px-3 py-1 rounded-md text-sm" disabled>Redo</button>
                        </div>
                    </div>
                    <div class="flex flex-col flex-grow overflow-hidden rounded-lg border border-[#30363d]">
                        <div id="editor-tabs" class="flex items-center bg-gray-800 flex-shrink-0">
                            <!-- Tabs will be dynamically added here -->
                        </div>
                        <div id="code-editor" class="code-font w-full text-sm flex-grow bg-gray-900 overflow-hidden"></div>
                    </div>
                </div>
            </main>
            
            <main id="source-control-view" class="hidden h-full flex p-4 text-sm">
                <div class="w-1/3 pr-4 border-r border-gray-700">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-semibold">Source Control</h3>
                        <button id="git-refresh-btn" title="Refresh Status" class="action-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L20.5 10"/></svg>
                        </button>
                    </div>
                    <button id="clone-repo-btn" class="submit-btn w-full px-4 py-2 rounded-md mb-4 text-sm">Clone Repository</button>
                    
                    <div id="branch-management" class="mb-4">
                        <h4 class="font-semibold mb-2">Branch</h4>
                        <div class="flex items-center gap-2 mb-2">
                            <span id="current-branch-display" class="code-font bg-gray-900 px-2 py-1 rounded-md text-sm truncate">master</span>
                            <select id="branch-select" class="audit-input w-full text-sm rounded-md"></select>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                             <button id="switch-branch-btn" class="navigator-btn px-4 py-2 rounded-md text-sm">Switch</button>
                             <button id="new-branch-btn" class="navigator-btn px-4 py-2 rounded-md text-sm">New Branch</button>
                        </div>
                    </div>

                    <h4 class="font-semibold mt-4 mb-2">Changes</h4>
                    <div id="git-status-list" class="flex flex-col gap-1">
                        <p class="text-gray-500">No changes detected.</p>
                    </div>
                </div>
                <div class="w-2/3 pl-4 flex flex-col h-full">
                    <!-- Diff view takes most of the space -->
                    <div class="flex-grow flex flex-col min-h-0">
                        <h3 class="text-lg font-semibold mb-2">Changes</h3>
                        <div id="git-diff-view" class="flex-grow overflow-y-auto code-font bg-gray-900 rounded-lg p-2 border border-gray-700">
                            <p class="text-gray-500">Select a file from the 'Changes' list to see differences.</p>
                        </div>
                    </div>

                    <!-- Commit and history at the bottom -->
                    <div class="flex-shrink-0 pt-4">
                        <h3 class="text-lg font-semibold mb-2">Commit</h3>
                        <textarea id="commit-message-input" class="audit-input w-full p-2 text-sm rounded-lg mb-2 code-font" placeholder="Commit message" rows="3"></textarea>
                        <div class="flex justify-end items-center gap-4">
                            <button id="commit-btn" class="submit-btn px-4 py-2 rounded-md text-sm" disabled>Commit</button>
                            <button id="push-btn" class="navigator-btn px-4 py-2 rounded-md text-sm" disabled>Push</button>
                        </div>
                        <h3 class="text-lg font-semibold mt-4 mb-2">History</h3>
                        <div id="git-log-list" class="overflow-y-auto code-font bg-gray-900 rounded-lg p-2 h-48 border border-gray-700">
                            <p class="text-gray-500">No commits to show.</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <script type="module" src="script.js"></script>
</body>
</html>

